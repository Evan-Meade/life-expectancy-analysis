


<div id="summary" class="section level2">
<h2>Summary</h2>
<ul>
<li>Developed countries have 12 year higher life expectancies than developing countries, on average</li>
<li>Average national life expectancy is increasing at about a third of a year per year</li>
<li>Errors in the 9-parameter model are approximately normal</li>
<li>Average errors for each country (averaged over time) are also approximately normal</li>
<li>There are outliers over- and under-performing on average over this time period</li>
</ul>
<p>Next steps:</p>
<ul>
<li>Statistically test for significance of these over- and under-performers</li>
<li>Try adding Status.proxy and Year as parameters to the model for increased accuracy</li>
</ul>
</div>
<div id="imports" class="section level2">
<h2>Imports</h2>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.1.0     ✓ dplyr   1.0.5
## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>data &lt;- read_csv(&quot;life_CLEAN.csv&quot;)</code></pre>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   Country = col_character(),
##   Year = col_double(),
##   Status = col_character(),
##   Life.expectancy = col_double(),
##   Schooling = col_double(),
##   GDP = col_double(),
##   Alcohol = col_double(),
##   BMI = col_double(),
##   percentage.expenditure = col_double(),
##   Income.composition.of.resources = col_double(),
##   HIV.AIDS = col_double(),
##   thinness.5.9.years = col_double(),
##   thinness.10.19.years = col_double()
## )</code></pre>
<pre class="r"><code>data</code></pre>
<pre><code>## # A tibble: 2,311 x 13
##    Country      Year Status     Life.expectancy Schooling   GDP Alcohol   BMI
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghanistan  2015 Developing            65        10.1 584.     0.01  19.1
##  2 Afghanistan  2014 Developing            59.9      10   613.     0.01  18.6
##  3 Afghanistan  2013 Developing            59.9       9.9 632.     0.01  18.1
##  4 Afghanistan  2012 Developing            59.5       9.8 670.     0.01  17.6
##  5 Afghanistan  2011 Developing            59.2       9.5  63.5    0.01  17.2
##  6 Afghanistan  2010 Developing            58.8       9.2 553.     0.01  16.7
##  7 Afghanistan  2009 Developing            58.6       8.9 446.     0.01  16.2
##  8 Afghanistan  2008 Developing            58.1       8.7 373.     0.03  15.7
##  9 Afghanistan  2007 Developing            57.5       8.4 370.     0.02  15.2
## 10 Afghanistan  2006 Developing            57.3       8.1 273.     0.03  14.7
## # … with 2,301 more rows, and 5 more variables: percentage.expenditure &lt;dbl&gt;,
## #   Income.composition.of.resources &lt;dbl&gt;, HIV.AIDS &lt;dbl&gt;,
## #   thinness.5.9.years &lt;dbl&gt;, thinness.10.19.years &lt;dbl&gt;</code></pre>
</div>
<div id="temporal-analysis" class="section level2">
<h2>Temporal Analysis</h2>
<pre class="r"><code>year_averages &lt;- aggregate(Life.expectancy ~ Year, data = data, FUN = mean)

ggplot(data = year_averages, mapping = aes(x = Year, y = Life.expectancy)) +
  geom_line() +
  labs(title = &quot;Average National Life Expectancy Over Time&quot;,
       x = &quot;Year&quot;,
       y = &quot;Average National Life Expectancy (Years)&quot;) +
  stat_smooth(method = &quot;lm&quot;, se = FALSE, linetype = &quot;dashed&quot;)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="evan-analysis_files/figure-html/over_time-1.png" width="672" /></p>
<pre class="r"><code># savefig(&quot;life_expectancy__year.png&quot;)

summary(lm(Life.expectancy ~ Year, data = year_averages))</code></pre>
<pre><code>## 
## Call:
## lm(formula = Life.expectancy ~ Year, data = year_averages)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.2597 -0.6871 -0.2405  0.0802  4.3518 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -907.02839  145.05142  -6.253 2.12e-05 ***
## Year           0.48662    0.07225   6.735 9.55e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.332 on 14 degrees of freedom
## Multiple R-squared:  0.7641, Adjusted R-squared:  0.7473 
## F-statistic: 45.36 on 1 and 14 DF,  p-value: 9.551e-06</code></pre>
<pre class="r"><code>status_averages &lt;- aggregate(Life.expectancy ~ Year + Status, data = data, FUN = mean)

ggplot(data = status_averages, mapping = aes(x = Year, y = Life.expectancy)) +
  geom_line(mapping = aes(color = Status)) +
  labs(title = &quot;Average National Life Expectancy Over Time, By Development Status&quot;,
       x = &quot;Year&quot;,
       y = &quot;Average National Life Expectancy (Years)&quot;) +
  stat_smooth(mapping = aes(group = Status), method = &quot;lm&quot;, se = FALSE,
              color = &quot;black&quot;, size = 0.5, linetype = &quot;dashed&quot;)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="evan-analysis_files/figure-html/status_time-1.png" width="672" /></p>
<pre class="r"><code>data$Status.proxy &lt;- as.integer(factor(data$Status, levels = c(&quot;Developing&quot;,
                                                               &quot;Developed&quot;),
                                       labels = c(0, 1))) - 1
summary(lm(Life.expectancy ~ Status.proxy + Year, data = data))</code></pre>
<pre><code>## 
## Call:
## lm(formula = Life.expectancy ~ Status.proxy + Year, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -31.883  -5.658   1.239   6.384  21.901 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -657.67632   80.43631  -8.176 4.77e-16 ***
## Status.proxy   12.22552    0.44800  27.289  &lt; 2e-16 ***
## Year            0.36112    0.04008   9.011  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 8.328 on 2308 degrees of freedom
## Multiple R-squared:  0.2642, Adjusted R-squared:  0.2636 
## F-statistic: 414.4 on 2 and 2308 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>So clearly country status is a large factor in life expectancy over time. On average, developed countries have life expectancies over 12 years higher than developing countries. Additionally, every year raises the global life expectancy by about a third of a year. These coefficients are highly significant and graphically the trends look relatively constant. If we extrapolate this pattern forwards, that means each person can expect to life on average, 1.5 times as long as the life expectancy when they were born. For people born around 2000, that’s about 116 years old.</p>
</div>
<div id="model-fitting" class="section level2">
<h2>Model Fitting</h2>
<pre class="r"><code>model &lt;- lm(Life.expectancy ~ Schooling + GDP + Alcohol + BMI +
              percentage.expenditure + Income.composition.of.resources +
              HIV.AIDS + thinness.5.9.years + thinness.10.19.years, data = data)
summary(model)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Life.expectancy ~ Schooling + GDP + Alcohol + BMI + 
##     percentage.expenditure + Income.composition.of.resources + 
##     HIV.AIDS + thinness.5.9.years + thinness.10.19.years, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -27.5813  -2.5470  -0.0207   2.6412  25.4956 
## 
## Coefficients:
##                                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                      4.980e+01  4.985e-01  99.895  &lt; 2e-16 ***
## Schooling                        1.078e+00  5.206e-02  20.702  &lt; 2e-16 ***
## GDP                              4.434e-05  1.709e-05   2.594 0.009537 ** 
## Alcohol                         -1.009e-01  2.961e-02  -3.407 0.000668 ***
## BMI                              5.476e-02  6.336e-03   8.642  &lt; 2e-16 ***
## percentage.expenditure           1.773e-04  1.111e-04   1.596 0.110670    
## Income.composition.of.resources  9.957e+00  7.498e-01  13.279  &lt; 2e-16 ***
## HIV.AIDS                        -6.609e-01  1.768e-02 -37.389  &lt; 2e-16 ***
## thinness.5.9.years              -4.548e-02  5.638e-02  -0.807 0.419871    
## thinness.10.19.years            -7.606e-02  5.757e-02  -1.321 0.186593    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.522 on 2301 degrees of freedom
## Multiple R-squared:  0.7837, Adjusted R-squared:  0.7829 
## F-statistic: 926.5 on 9 and 2301 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="over--and-under-performing-countries" class="section level2">
<h2>Over- and Under-Performing Countries</h2>
<pre class="r"><code>data$y.hat &lt;- predict(model, data)
data$error &lt;- data$Life.expectancy - data$y.hat

country_subset &lt;- c(&quot;Norway&quot;, &quot;China&quot;, &quot;Ghana&quot;, &quot;Chile&quot;, &quot;Vietnam&quot;)
ggplot(data = data[which(data$Country %in% country_subset), ]) +
  geom_line(mapping = aes(x = Year, y = error, color = Country))</code></pre>
<p><img src="evan-analysis_files/figure-html/predict-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = data) +
  geom_histogram(mapping = aes(x = error), binwidth = 1) +
  labs(title = &quot;Residuals For All Life Expectancy Observations&quot;,
       x = &quot;Residual (Years)&quot;,
       y = &quot;Count&quot;)</code></pre>
<p><img src="evan-analysis_files/figure-html/errors-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = data) +
  geom_boxplot(mapping = aes(x = Year, group = Year, y = error)) +
  labs(title = &quot;Residual Distributions Over Time&quot;,
       x = &quot;Year&quot;,
       y = &quot;Residual (Years)&quot;)</code></pre>
<p><img src="evan-analysis_files/figure-html/errors-2.png" width="672" /></p>
<p>We can investigate the probability that a country would have error sample means of these magnitudes.</p>
<p><span class="math display">\[
H_0: \epsilon\sim N(0,\sigma^2)\text{ for all countries }
\\
H_1: \epsilon\not\sim N(0,\sigma^2)\text{ for at least one country }
\\
z_j = \sum_{i=1}^{n_j}\epsilon = \sum_{i=1}^{n_j}N(0,\sigma^2) \sim N(0,n_j\sigma^2) \text{ for each country }j
\]</span></p>
<pre class="r"><code># av_error &lt;- aggregate(error ~ Country, data = data, FUN = mean)
rse &lt;- summary(model)$sigma
av_error &lt;- data %&gt;%
  group_by(Country) %&gt;%
  summarize(count = n(), total_error = sum(error), mean_error = total_error / count) %&gt;%
  mutate(p_val = pnorm(abs(total_error), mean = 0, sd = sqrt(count) * rse, lower.tail = FALSE))

(signif_error &lt;- av_error %&gt;%
    filter(p_val &lt; 0.001) %&gt;%
    arrange(p_val))</code></pre>
<pre><code>## # A tibble: 43 x 5
##    Country                count total_error mean_error    p_val
##    &lt;chr&gt;                  &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1 Sierra Leone              15      -226.      -15.1  2.02e-38
##  2 Angola                    15      -181.      -12.1  1.91e-25
##  3 Antigua and Barbuda       15       149.        9.94 8.16e-18
##  4 Nigeria                   15      -114.       -7.58 4.15e-11
##  5 Swaziland                 15       112.        7.48 7.32e-11
##  6 Kazakhstan                15      -112.       -7.45 8.60e-11
##  7 Maldives                  15       105.        6.98 1.12e- 9
##  8 Bosnia and Herzegovina    15       102.        6.81 2.68e- 9
##  9 Russian Federation        15       -99.4      -6.63 6.87e- 9
## 10 Togo                      15       -95.9      -6.39 2.18e- 8
## # … with 33 more rows</code></pre>
<pre class="r"><code>ggplot(data = av_error) +
  geom_histogram(mapping = aes(x = mean_error)) +
  labs(title = &quot;Average Residuals of Each Nation&quot;,
       x = &quot;Average Residual (Years)&quot;,
       y = &quot;Count&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="evan-analysis_files/figure-html/over_under-1.png" width="672" /></p>
<pre class="r"><code>outlier_order &lt;- c(head(order(av_error$mean_error, decreasing = TRUE), 5),
                   tail(order(av_error$mean_error, decreasing = TRUE), 5))
av_error$over.rank &lt;- order(av_error$mean_error, decreasing = TRUE)
outliers &lt;- av_error$Country[outlier_order]
print(paste0(c(&quot;Top Over-perfomers: &quot;, outliers[1:5])))</code></pre>
<pre><code>## [1] &quot;Top Over-perfomers: &quot;   &quot;Antigua and Barbuda&quot;    &quot;Swaziland&quot;             
## [4] &quot;Maldives&quot;               &quot;Bosnia and Herzegovina&quot; &quot;Bangladesh&quot;</code></pre>
<pre class="r"><code>print(paste0(c(&quot;Top Under-perfomers: &quot;, outliers[10:6])))</code></pre>
<pre><code>## [1] &quot;Top Under-perfomers: &quot; &quot;Sierra Leone&quot;          &quot;Angola&quot;               
## [4] &quot;Nigeria&quot;               &quot;Kazakhstan&quot;            &quot;Russian Federation&quot;</code></pre>
<pre class="r"><code>outlier_data &lt;- data[which(data$Country %in% outliers), ]
outlier_data$Country &lt;- factor(outlier_data$Country, levels = outliers)

ggplot(data = outlier_data) +
  geom_line(mapping = aes(x = Year, y = error, color = Country)) +
  scale_color_brewer(palette = &quot;RdYlGn&quot;, direction = -1) +
  labs(title = &quot;Top Over- and Under-Performing National Life Expectancies&quot;,
       x = &quot;Year&quot;,
       y = &quot;Residual&quot;)</code></pre>
<p><img src="evan-analysis_files/figure-html/outliers-1.png" width="672" /></p>
</div>
